<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Deformable Squishy Game</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Itim&display=swap');

body {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: flex-start;
  height: 100vh;
  background: #f0f0f0;
  font-family: Arial, sans-serif;
  padding-top: 20px;
}

#gameArea {
  position: relative;
  width: 400px;
  height: 400px;
  background: #fff;
  border: 2px solid #ccc;
  border-radius: 20px;
  overflow: hidden;
}

#backBtn {
  position: absolute;
  top: 5px;
  left: 5px;
  padding: 5px 15px;
  font-family: itim, cursive;
  background-color: #e8b45e;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  z-index: 10;
}

.squishy {
  position: absolute;
  width: 100px;
  height: 100px;
  border-radius: 50%;
  background: #ff7f7f;
  cursor: grab;
  display: flex;
  align-items: center;
  justify-content: center;
  user-select: none;
  transition: border-radius 0.2s;
}

#controls {
  margin-top: 20px;
  font-family: itim, cursive;
}

input[type="color"] {
  padding: 5px;
}

button {
  padding: 5px 10px;
  margin-left: 5px;
  font-family: itim, cursive;
  cursor: pointer;
}
</style>
</head>
<body>

<h2 style="font-family:itim;">Squish & Bounce</h2>
<div id="gameArea">
  <!-- Back button on top of game box -->
  <button id="backBtn" onclick="window.location.href='leisure.php'">Back</button>
</div>

<div id="controls">
  <input type="color" id="colorPicker" value="#ff7f7f">
  <button id="changeShape">Toggle Shape</button>
  <button id="addSquishy">Add Squishy</button>
  <button id="removeSquishy">-1</button>
  <button id="clearSquishies">Clear All</button>
</div>

<script>
const gameArea = document.getElementById('gameArea');
const colorPicker = document.getElementById('colorPicker');
const changeShapeBtn = document.getElementById('changeShape');
const addSquishyBtn = document.getElementById('addSquishy');
const removeSquishyBtn = document.getElementById('removeSquishy');
const clearSquishiesBtn = document.getElementById('clearSquishies');

let squishies = [];
let currentSquishy = null;

function createSquishy() {
  const squishy = document.createElement('div');
  squishy.classList.add('squishy');
  squishy.style.left = Math.random() * (gameArea.clientWidth - 100) + 'px';
  squishy.style.top = Math.random() * (gameArea.clientHeight - 100) + 'px';

  let isDragging = false;
  let startX, startY, startWidth, startHeight, startLeft, startTop;
  let velocityX = 0, velocityY = 0;

  squishy.addEventListener('mousedown', (e) => {
    isDragging = true;
    startX = e.clientX;
    startY = e.clientY;
    startWidth = squishy.offsetWidth;
    startHeight = squishy.offsetHeight;
    startLeft = squishy.offsetLeft;
    startTop = squishy.offsetTop;
    squishy.style.cursor = 'grabbing';
    velocityX = 0;
    velocityY = 0;
  });

  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;
    const dx = e.clientX - startX;
    const dy = e.clientY - startY;

    squishy.style.width = Math.max(50, startWidth + dx) + 'px';
    squishy.style.height = Math.max(50, startHeight + dy) + 'px';
    squishy.style.left = startLeft + dx/2 + 'px';
    squishy.style.top = startTop + dy/2 + 'px';

    velocityX = dx / 2;
    velocityY = dy / 2;
  });

  document.addEventListener('mouseup', () => {
    if (isDragging) {
      isDragging = false;
      squishy.style.cursor = 'grab';
      startSquishyReturn(squishy, velocityX, velocityY);
    }
  });

  function startSquishyReturn(squishy, vx, vy) {
    let width = parseFloat(squishy.style.width);
    let height = parseFloat(squishy.style.height);
    let left = parseFloat(squishy.style.left);
    let top = parseFloat(squishy.style.top);
    const originalWidth = 100;
    const originalHeight = 100;
    const damping = 0.9;
    const elasticity = 0.2;

    function animate() {
      width += (originalWidth - width) * elasticity;
      height += (originalHeight - height) * elasticity;

      squishy.style.width = width + 'px';
      squishy.style.height = height + 'px';

      left += vx;
      top += vy;

      if (left < 0) { left = 0; vx = -vx*damping; }
      if (top < 0) { top = 0; vy = -vy*damping; }
      if (left + width > gameArea.clientWidth) { left = gameArea.clientWidth - width; vx = -vx*damping; }
      if (top + height > gameArea.clientHeight) { top = gameArea.clientHeight - height; vy = -vy*damping; }

      squishy.style.left = left + 'px';
      squishy.style.top = top + 'px';

      vx *= damping;
      vy *= damping;

      if (Math.abs(originalWidth - width) > 0.5 || Math.abs(originalHeight - height) > 0.5 || Math.abs(vx) > 0.1 || Math.abs(vy) > 0.1) {
        requestAnimationFrame(animate);
      } else {
        squishy.style.width = originalWidth + 'px';
        squishy.style.height = originalHeight + 'px';
      }
    }

    animate();
  }

  gameArea.appendChild(squishy);
  squishies.push(squishy);
  currentSquishy = squishy;
  return squishy;
}

createSquishy();

colorPicker.addEventListener('input', () => {
  if (currentSquishy) currentSquishy.style.background = colorPicker.value;
});

changeShapeBtn.addEventListener('click', () => {
  if (!currentSquishy) return;
  currentSquishy.style.borderRadius = currentSquishy.style.borderRadius === '50%' ? '20%' : '50%';
});

addSquishyBtn.addEventListener('click', () => {
  createSquishy();
});

removeSquishyBtn.addEventListener('click', () => {
  if (squishies.length === 0) return;
  const last = squishies.pop();
  gameArea.removeChild(last);
  currentSquishy = squishies[squishies.length - 1] || null;
});

clearSquishiesBtn.addEventListener('click', () => {
  squishies.forEach(s => gameArea.removeChild(s));
  squishies = [];
  currentSquishy = null;
});
</script>

</body>
</html>
