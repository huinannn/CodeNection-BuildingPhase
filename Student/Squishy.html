<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Squishy Toy — Random Plush</title>
  <style>
    :root{--bg:#f7f3ff;--card:#fff;--accent:#ff8fab}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg),#fff);}
    .stage{width:100%;max-width:720px;height:90vh;background:var(--card);border-radius:18px;box-shadow:0 12px 30px rgba(30,20,60,0.08);position:relative;overflow:hidden}
    header{position:absolute;left:16px;top:12px;z-index:30;display:flex;gap:10px;align-items:center}
    header h1{margin:0;font-size:16px;color:#3b2b4b}
    .hint{position:absolute;right:16px;top:12px;color:#6b5a79;font-size:13px}
    canvas{width:100%;height:100%;display:block}
    .ui{position:absolute;left:16px;bottom:16px;z-index:30;display:flex;gap:8px}
    button{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:12px;font-weight:600;box-shadow:0 6px 16px rgba(255,139,171,0.18);cursor:pointer}
    .small{padding:8px 10px;border-radius:10px;font-weight:600}
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <header>
      <h1>Squishy Toy — Drag & Throw</h1>
    </header>
    <div class="hint">Hold & drag to deform • Throw to toss</div>
    <canvas id="c"></canvas>
    <div class="ui">
      <button id="reset">Reset</button>
      <button id="toggleSound" class="small">Sound: On</button>
    </div>
  </div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let DPR = Math.min(window.devicePixelRatio || 1, 2);
function resize(){canvas.width = canvas.clientWidth*DPR; canvas.height = canvas.clientHeight*DPR;}
resize();
window.addEventListener('resize', ()=>{resize();});

// Toy options
const shapes = ['circle','square','star','heart','blob'];
const skins = ['Labubu','PaoPao','Plush'];
function randomColor(){ return '#'+Math.floor(Math.random()*16777215).toString(16); }
function randomChoice(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

// Toy state
const toy = {
  x: canvas.width/2, y: canvas.height*0.6, vx:0, vy:0, r: Math.min(canvas.width,canvas.height)/8, angle:0,
  deformX:1, deformY:1, shape:'circle', skin:'Labubu', color1:'#ffd9e4', color2:'#ff9db2'
};

let touching=false, startPos=null, lastPos=null, soundOn=true;

const AudioCtx = window.AudioContext || window.webkitAudioContext;
const ACTX = AudioCtx ? new AudioCtx() : null;
function playSquish(intensity=0.7){
  if(!ACTX || !soundOn) return;
  const now = ACTX.currentTime;
  const o = ACTX.createOscillator();
  const g = ACTX.createGain();
  o.type='triangle'; o.frequency.setValueAtTime(200+Math.random()*120, now);
  g.gain.value=0.0001;
  g.gain.exponentialRampToValueAtTime(0.25*intensity, now+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, now+0.45);
  o.connect(g); g.connect(ACTX.destination);
  o.start(now); o.stop(now+0.5);
}

function toLocal(e){const rect=canvas.getBoundingClientRect(); if(e.touches)e=e.touches[0]; return {x:(e.clientX-rect.left)*DPR, y:(e.clientY-rect.top)*DPR};}

canvas.addEventListener('pointerdown', (ev)=>{canvas.setPointerCapture(ev.pointerId); touching=true; startPos=toLocal(ev); lastPos=startPos;});
canvas.addEventListener('pointermove', (ev)=>{if(!touching) return; const p=toLocal(ev); lastPos=p; const dx=p.x-toy.x, dy=p.y-toy.y, dist=Math.hypot(dx,dy); if(dist<toy.r*1.2){ toy.deformX *= 1-dx/(toy.r*10); toy.deformY *= 1-dy/(toy.r*10); toy.deformX=Math.max(0.5,Math.min(1.5,toy.deformX)); toy.deformY=Math.max(0.5,Math.min(1.5,toy.deformY)); playSquish(0.8); }});
canvas.addEventListener('pointerup', (ev)=>{canvas.releasePointerCapture(ev.pointerId); if(!touching) return; touching=false; const end=lastPos||toLocal(ev); if(startPos){ const dx=end.x-startPos.x, dy=end.y-startPos.y; toy.vx=dx/12; toy.vy=dy/12; }});

const GRAV=0.35*DPR, FRICTION=0.995;
function update(){
  toy.r=Math.min(canvas.width,canvas.height)/8;
  toy.vy+=GRAV; toy.vx*=FRICTION; toy.vy*=0.999;
  toy.x+=toy.vx; toy.y+=toy.vy; toy.angle+=toy.vx*0.01;
  if(toy.y+toy.r*toy.deformY>canvas.height){toy.y=canvas.height-toy.r*toy.deformY; toy.vy*=-0.55; toy.vx*=0.9; playSquish(Math.min(1,Math.abs(toy.vy)/30));}
  if(toy.x-toy.r*toy.deformX<0){toy.x=toy.r*toy.deformX; toy.vx*=-0.6;}
  if(toy.x+toy.r*toy.deformX>canvas.width){toy.x=canvas.width-toy.r*toy.deformX; toy.vx*=-0.6;}
}

function drawToy(){
  const x=toy.x, y=toy.y, r=toy.r;
  ctx.save(); ctx.translate(x,y); ctx.rotate(toy.angle); ctx.scale(toy.deformX,toy.deformY);
  const g=ctx.createLinearGradient(-r,-r,r,r); g.addColorStop(0,toy.color1); g.addColorStop(1,toy.color2);
  ctx.fillStyle=g;
  switch(toy.shape){
    case 'circle': ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fill(); break;
    case 'square': ctx.fillRect(-r,-r,2*r,2*r); break;
    case 'star': drawStar(ctx,0,0,r,5); break;
    case 'heart': drawHeart(ctx,0,0,r); break;
    case 'blob': drawBlob(ctx,0,0,r); break;
  }
  ctx.restore();
}

function drawStar(ctx,x,y,r,points){ctx.beginPath(); for(let i=0;i<2*points;i++){const angle=i*Math.PI/points; const rad=i%2===0?r:r/2; ctx.lineTo(x+Math.cos(angle)*rad,y+Math.sin(angle)*rad);} ctx.closePath(); ctx.fill();}
function drawHeart(ctx,x,y,r){ctx.beginPath();ctx.moveTo(x, y+r/4);ctx.bezierCurveTo(x+r/2,y-r/2, x+r,y+r/3, x, y+r);ctx.bezierCurveTo(x-r,y+r/3, x-r/2,y-r/2, x,y+r/4); ctx.fill();}
function drawBlob(ctx,x,y,r){ctx.beginPath(); ctx.moveTo(x+r*0.5,y-r*0.5); ctx.quadraticCurveTo(x+r,y, x+r*0.3,y+r*0.6); ctx.quadraticCurveTo(x, y+r*0.3, x-r*0.5,y+r*0.5); ctx.quadraticCurveTo(x-r*0.6, y, x-r*0.3,y-r*0.6); ctx.quadraticCurveTo(x, y-r*0.3, x+r*0.5,y-r*0.5); ctx.fill();}

function render(){ctx.clearRect(0,0,canvas.width,canvas.height); ctx.fillStyle='#fff'; ctx.fillRect(0,0,canvas.width,canvas.height);
  const hg=ctx.createLinearGradient(0,0,0,canvas.height); hg.addColorStop(0,'rgba(255,245,250,0.6)'); hg.addColorStop(1,'rgba(250,255,255,0.4)'); ctx.fillStyle=hg; ctx.fillRect(0,0,canvas.width,canvas.height);
  drawToy();}
function tick(){update(); render(); requestAnimationFrame(tick);}

function randomToy(){ toy.shape=randomChoice(shapes); toy.skin=randomChoice(skins); toy.color1=randomColor(); toy.color2=randomColor(); toy.deformX=toy.deformY=1; toy.x=canvas.width/2; toy.y=canvas.height*0.55; toy.vx=toy.vy=toy.angle=0;}
randomToy();
requestAnimationFrame(tick);

document.getElementById('reset').addEventListener('click', ()=>{ randomToy(); });
const sndBtn=document.getElementById('toggleSound');
sndBtn.addEventListener('click',()=>{ soundOn=!soundOn; sndBtn.textContent='Sound: '+(soundOn?'On':'Off'); if(soundOn && ACTX && ACTX.state==='suspended') ACTX.resume();});
canvas.addEventListener('touchstart', e=>{ e.preventDefault(); }, {passive:false});
</script>
</body>
</html>
