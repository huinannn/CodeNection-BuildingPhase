<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Squishy Toy ‚Äî Play</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Itim&display=swap');
    @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap');

    :root{--bg:#f7f3ff;--card:#fff;--accent:#ff8fab}
    html,body{
        height:100%;margin:0;font-family:Itim;}
    body{display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,var(--bg),#fff);}
    .stage{width:100%;max-width:720px;height:90vh;background:var(--card);border-radius:18px;box-shadow:0 12px 30px rgba(30,20,60,0.08);position:relative;overflow:hidden}
    .hint{position:absolute;right:16px;top:12px;color:#6b5a79;font-size:13px}
    canvas{width:100%;height:100%;display:block}
    .ui{position:absolute;left:16px;bottom:16px;z-index:30;display:flex;gap:8px;flex-wrap:wrap;}
    button, select, input{background:var(--accent);border:none;color:white;padding:10px 14px;border-radius:12px;font-weight:600;box-shadow:0 6px 16px rgba(255,139,171,0.18);cursor:pointer}
    input[type=color]{padding:0; width:40px; height:40px;}
    .small{padding:8px 10px;border-radius:10px;font-weight:600}
    select{appearance:none;}
    .back{position:absolute;top:12px;left:16px;font-size:20px;text-decoration:none;color:#3b2b4b;font-weight:bold;z-index:30;}
  </style>
</head>
<body>
  <div class="stage" id="stage">
    <a href="leisure.php" class="back">‚Üê Back</a>
    <div class="hint">Tap & hold to squish ‚Ä¢ Drag to throw</div>
    <canvas id="c"></canvas>
    <div class="ui">
      <button id="reset">Reset</button>
      <button id="toggleSound" class="small">Sound: On</button>
      <select id="faceSelect" class="small">
        <option value="smile">üòä Smile</option>
        <option value="sad">üò¢ Sad</option>
        <option value="angry">üò† Angry</option>
        <option value="surprised">üòÆ Surprised</option>
      </select>
      <input type="color" id="color1" title="Top Color" value="#ffd9e4">
      <input type="color" id="color2" title="Bottom Color" value="#ff9db2">
    </div>
  </div>

<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
let DPR = Math.min(window.devicePixelRatio || 1, 2);
function resize(){ canvas.width = canvas.clientWidth * DPR; canvas.height = canvas.clientHeight * DPR; }
resize();
window.addEventListener('resize', ()=>{resize();});

// Toy state
const toy = {
  x: canvas.width/2,
  y: canvas.height*0.6,
  vx:0, vy:0,
  r: Math.min(canvas.width, canvas.height)/8,
  angle:0,
  squish:0,
  color1:'#ffd9e4', color2:'#ff9db2'
};

let touching=false, startPos=null, lastPos=null, soundOn=true, faceType='smile';

// Audio
const AudioCtx = window.AudioContext || window.webkitAudioContext;
const ACTX = AudioCtx ? new AudioCtx() : null;
function playSquish(intensity=0.7){
  if(!ACTX || !soundOn) return;
  const now = ACTX.currentTime;
  const o = ACTX.createOscillator();
  const g = ACTX.createGain();
  o.type='sine'; o.frequency.setValueAtTime(220 + Math.random()*100, now);
  g.gain.value = 0.0001;
  g.gain.exponentialRampToValueAtTime(0.25*intensity, now+0.01);
  g.gain.exponentialRampToValueAtTime(0.0001, now+0.45);
  o.connect(g); g.connect(ACTX.destination);
  o.start(now); o.stop(now+0.5);
}

// Face selection
document.getElementById('faceSelect').addEventListener('change', e => { faceType = e.target.value; });

// Color pickers
document.getElementById('color1').addEventListener('input', e => { toy.color1 = e.target.value; });
document.getElementById('color2').addEventListener('input', e => { toy.color2 = e.target.value; });

// Interaction
function toLocal(e){ const rect = canvas.getBoundingClientRect(); if(e.touches) e = e.touches[0]; return {x:(e.clientX-rect.left)*DPR, y:(e.clientY-rect.top)*DPR}; }

canvas.addEventListener('pointerdown', ev=>{
  canvas.setPointerCapture(ev.pointerId);
  touching = true;
  startPos = toLocal(ev);
  lastPos = startPos;
  const dx = startPos.x - toy.x, dy = startPos.y - toy.y;
  const d = Math.hypot(dx,dy);
  if(d < toy.r*1.1){ toy.squish = 1; toy.vx = toy.vy = 0; playSquish(0.9); }
});

canvas.addEventListener('pointermove', ev=>{
  if(!touching) return;
  const p = toLocal(ev); lastPos = p;
  const dx = p.x - toy.x, dy = p.y - toy.y;
  const d = Math.hypot(dx,dy);
  if(toy.squish > 0){ toy.x = p.x - dx*0.2; toy.y = p.y - dy*0.2; toy.squish = Math.max(0.2, 1 - d/(toy.r*1.2)); }
});

canvas.addEventListener('pointerup', ev=>{
  canvas.releasePointerCapture(ev.pointerId);
  if(!touching) return;
  touching=false;
  const end = lastPos || toLocal(ev);
  if(startPos){ toy.vx = (end.x-startPos.x)/12; toy.vy = (end.y-startPos.y)/12; }
  if(toy.squish>0) playSquish(0.6); toy.squish = 0;
});

// Physics & draw
const GRAV = 0.35 * DPR; const FRICTION = 0.995;
function update(){
  toy.r = Math.min(canvas.width, canvas.height)/8;
  toy.vy += GRAV;
  toy.vx *= FRICTION; toy.vy *= 0.999;
  toy.x += toy.vx; toy.y += toy.vy;
  toy.angle += toy.vx*0.01;
  if(toy.y + toy.r > canvas.height){ toy.y = canvas.height - toy.r; toy.vy *= -0.55; toy.vx *= 0.9; playSquish(Math.min(1, Math.abs(toy.vy)/30)); }
  if(toy.x - toy.r < 0){ toy.x = toy.r; toy.vx *= -0.6; }
  if(toy.x + toy.r > canvas.width){ toy.x = canvas.width - toy.r; toy.vx *= -0.6; }
}

function drawToy(){
  const x=toy.x, y=toy.y, r=toy.r; ctx.save(); ctx.translate(x,y); ctx.rotate(toy.angle);
  const squ=1-toy.squish*0.35; ctx.scale(1,squ);

  // shadow
  ctx.beginPath(); ctx.ellipse(0,r*1.05,r*0.9,r*0.28,0,0,Math.PI*2); ctx.fillStyle='rgba(60,30,80,0.08)'; ctx.fill();

  // body
  const g = ctx.createLinearGradient(-r,-r,r,r); g.addColorStop(0,toy.color1); g.addColorStop(1,toy.color2);
  ctx.beginPath(); ctx.arc(0,0,r,0,Math.PI*2); ctx.fillStyle=g; ctx.fill();

  // eyes
  ctx.fillStyle='#2b1b2f';
  ctx.beginPath(); ctx.ellipse(-r*0.35,-r*0.05,r*0.12,r*0.16,0,0,Math.PI*2); ctx.fill();
  ctx.beginPath(); ctx.ellipse(r*0.35,-r*0.05,r*0.12,r*0.16,0,0,Math.PI*2); ctx.fill();

  // mouth
  ctx.lineWidth=Math.max(2,r*0.06); ctx.lineCap='round'; ctx.beginPath();
  switch(faceType){
    case 'smile': ctx.strokeStyle='rgba(43,27,47,0.9)'; ctx.arc(0,r*0.08,r*0.38,Math.PI*0.15,Math.PI*0.85); ctx.stroke(); break;
case 'sad':
  ctx.strokeStyle = 'rgba(43,27,47,0.9)';
  const width = r * 0.6;
  const height = r * 0.25;
  ctx.beginPath();
  ctx.moveTo(-width/2, r*0.08); // left end
  ctx.quadraticCurveTo(0, r*0.08 - height, width/2, r*0.08); // middle up, right end
  ctx.stroke();
  
  break;
    case 'angry':
      ctx.strokeStyle='rgba(43,27,47,0.9)'; ctx.moveTo(-r*0.35,r*0.1); ctx.lineTo(r*0.35,r*0.1); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(-r*0.45,-r*0.2); ctx.lineTo(-r*0.2,-r*0.05);
      ctx.moveTo(r*0.45,-r*0.2); ctx.lineTo(r*0.2,-r*0.05); ctx.stroke(); break;
    case 'surprised': ctx.strokeStyle='rgba(43,27,47,0.9)'; ctx.arc(0,r*0.1,r*0.12,0,Math.PI*2); ctx.stroke(); break;
  }
  ctx.restore();
}

function render(){ ctx.clearRect(0,0,canvas.width,canvas.height); const hg=ctx.createLinearGradient(0,0,0,canvas.height); hg.addColorStop(0,'rgba(255,245,250,0.6)'); hg.addColorStop(1,'rgba(250,255,255,0.4)'); ctx.fillStyle=hg; ctx.fillRect(0,0,canvas.width,canvas.height); drawToy(); }
function tick(){ update(); render(); requestAnimationFrame(tick); }

toy.x = canvas.width/2; toy.y = canvas.height*0.55; requestAnimationFrame(tick);

// UI
document.getElementById('reset').addEventListener('click', ()=>{ toy.x = canvas.width/2; toy.y = canvas.height*0.55; toy.vx = toy.vy = 0; toy.angle=0; toy.squish=0; });
const sndBtn = document.getElementById('toggleSound');
sndBtn.addEventListener('click', ()=>{ soundOn=!soundOn; sndBtn.textContent='Sound: '+(soundOn?'On':'Off'); if(soundOn && ACTX && ACTX.state==='suspended') ACTX.resume(); });
canvas.addEventListener('touchstart', e=>{ e.preventDefault(); }, {passive:false});
</script>
</body>
</html>
